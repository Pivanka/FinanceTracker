<div class="flex flex-col items-start h-full w-full overflow-hidden">
  <div class="header">
    <h3>Optimize your budget!</h3>
    <p class="text-grey-2">You can add you preferences of categories allocation or service can do it from you last three months.</p>
  </div>
  <div class="h-full flex flex-row overflow-hidden">
    <div class="h-full">
      <form class="h-5/6 flex flex-col pb-4" [formGroup]="form">
        <div class="mb-2">
          <p class="text">Set your monthly budget</p>
          <div class="flex items-center justify-between">
            <div class="w-64 flex">
              <div class="currency__value w-20" *ngIf="(currency$ | async) as c">{{c}}</div>
              <app-input class="currency w-44" [control]="budget" placeholder="00.00" [type]="'number'"></app-input>
            </div>
          </div>
        </div>
        <div class="pt-4 w-80 flex-1 pr-4 overflow-y-auto">
          <div formArrayName="items">
            <div *ngFor="let item of items?.controls; let i=index" [formGroupName]="i">
              <div class="flex justify-between">
                <h3>Requirement {{i+1}}</h3>
                <img src="../../../../assets/images/icons/close.svg" alt="" (click)="removeItemFormGroup(i)">
              </div>
              <div class="mb-4">
                <div>
                  <p class="text">Category</p>
                  <div class="flex justify-start">
                    <div class="w-full">
                      <app-category-dropdown [formControl]="$any(items).controls[i].get('category')!" [categories]="categories$"
                        [customCategories]="customCategories$" [type]="'Expense'"></app-category-dropdown>
                    </div>
                  </div>
                </div>
                <div class="my-4">
                  <p class="text">Amount</p>
                  <div class="flex items-center justify-between">
                    <div class="w-full flex">
                      <app-dropdown [items]="['min', 'max']" [formControl]="$any(items).controls[i].get('type')!"></app-dropdown>
                      <app-input class="w-full" placeholder="00.00" [type]="'text'"
                        [control]="$any(items).controls[i].get('amount')!"></app-input>
                    </div>
                    <div
                      *ngIf="$any(items).controls[i].get('amount').hasError('pattern') && $any(items).controls[i].get('amount').touched"
                      class="error-message w-full help-text">
                      wrong format
                    </div>
                    <div
                      *ngIf="$any(items).controls[i].get('amount').hasError('required') && $any(items).controls[i].get('amount').touched"
                      class="error-message w-full help-text">
                      required
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <app-button variant="outlined" [config]="addItemButtonConfig"></app-button>
        </div>
      </form>
      <app-button [config]="submitButtonConfig"></app-button>
    </div>
    <div *ngIf="(optimizedBudget$ | async) as vm">
      <div *ngFor="let item of vm.result">
        {{item.category}} - {{item.amount | number}} {{(currency$ | async) ?? 'UAH'}}
      </div>
    </div>
  </div>
</div>
